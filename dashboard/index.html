<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Pearl View — Lead Management</title>
  <link rel="stylesheet" href="style.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
</head>
<body>

<!-- ══════════════ SIDEBAR ══════════════ -->
<aside class="sidebar">
  <div class="logo">
    <div class="logo-icon">PV</div>
    <div>
      <span class="logo-name">Pearl View</span>
      <span class="logo-sub">Lead Management</span>
    </div>
  </div>
  <nav class="nav">
    <div class="nav-lbl">Main</div>
    <div class="nav-item" data-page="overview" onclick="showPage('overview',this)">
      <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7" rx="1"/><rect x="14" y="3" width="7" height="7" rx="1"/><rect x="3" y="14" width="7" height="7" rx="1"/><rect x="14" y="14" width="7" height="7" rx="1"/></svg>
      Overview
    </div>
    <div class="nav-item active" data-page="leads" onclick="showPage('leads',this)">
      <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/></svg>
      Leads
      <span class="nav-badge" id="nav-count">—</span>
    </div>
    <div class="nav-item" data-page="calendar" onclick="showPage('calendar',this)">
      <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2"/><path d="M16 2v4M8 2v4M3 10h18"/></svg>
      Calendar
    </div>
    <div class="nav-item" data-page="clients" onclick="showPage('clients',this)">
      <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path d="M17 20h5v-2a4 4 0 00-4-4H6a4 4 0 00-4 4v2h5M12 12a4 4 0 100-8 4 4 0 000 8z"/></svg>
      Clients
    </div>
    <div class="nav-lbl" style="margin-top:6px">Business</div>
    <div class="nav-item" data-page="reports" onclick="showPage('reports',this)">
      <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/></svg>
      Reports
    </div>
    <div class="nav-item" data-page="crew" onclick="showPage('crew',this)">
      <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path d="M17 20h5v-2a4 4 0 00-4-4H6a4 4 0 00-4 4v2h5"/><circle cx="12" cy="7" r="4"/></svg>
      Crew & Jobs
    </div>
  </nav>
  <div class="sidebar-footer">
    <div class="nav-item" data-page="settings" onclick="showPage('settings',this)">
      <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 010 2.83 2 2 0 01-2.83 0l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-4 0v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83-2.83l.06-.06A1.65 1.65 0 004.68 15a1.65 1.65 0 00-1.51-1H3a2 2 0 010-4h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 012.83-2.83l.06.06A1.65 1.65 0 009 4.68a1.65 1.65 0 001-1.51V3a2 2 0 014 0v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 2.83l-.06.06A1.65 1.65 0 0019.4 9a1.65 1.65 0 001.51 1H21a2 2 0 010 4h-.09a1.65 1.65 0 00-1.51 1z"/></svg>
      Settings
    </div>
  </div>
</aside>

<!-- ══════════════ MAIN ══════════════ -->
<main class="main">

  <!-- Top Bar -->
  <header class="topbar">
    <span class="topbar-title">Leads Dashboard</span>
    <div class="search-wrap">
      <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5"><circle cx="11" cy="11" r="8"/><path d="M21 21l-4.35-4.35"/></svg>
      <input type="text" placeholder="Search leads…" oninput="searchLeads(this.value)" />
    </div>
    <div class="topbar-right">
      <button class="notif-btn" title="Refresh from Airtable" onclick="fetchAllFromAirtable()" style="background:var(--blue-50);border:1.5px solid var(--blue-200);">
        <svg fill="none" viewBox="0 0 24 24" stroke="var(--primary)" stroke-width="2" style="width:15px;height:15px"><path d="M23 4v6h-6M1 20v-6h6"/><path d="M3.51 9a9 9 0 0114.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0020.49 15"/></svg>
      </button>
      <button class="btn-new" onclick="openModal()">
        <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5" style="width:14px;height:14px"><path d="M12 5v14M5 12h14"/></svg>
        New Lead
      </button>
      <button class="notif-btn">
        <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" style="width:16px;height:16px"><path d="M18 8A6 6 0 006 8c0 7-3 9-3 9h18s-3-2-3-9M13.73 21a2 2 0 01-3.46 0"/></svg>
        <span class="notif-dot"></span>
      </button>
      <div class="user-chip">
        <div class="avatar">AC</div>
        <span class="user-name">Asaf C.</span>
      </div>
    </div>
  </header>

  <!-- Page content -->
  <div class="page" id="page-leads">

    <!-- Stats -->
    <div class="stats">
      <div class="stat-card">
        <div class="stat-top">
          <span class="stat-lbl">New Leads</span>
          <div class="stat-ico" style="background:#eff6ff">
            <svg fill="none" viewBox="0 0 24 24" stroke="#2563eb" stroke-width="2"><path d="M16 21v-2a4 4 0 00-4-4H6a4 4 0 00-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 00-3-3.87M16 3.13a4 4 0 010 7.75"/></svg>
          </div>
        </div>
        <div class="stat-val" id="stat-new">—</div>
        <div class="stat-sub" id="stat-new-sub">Loading…</div>
      </div>
      <div class="stat-card">
        <div class="stat-top">
          <span class="stat-lbl">Calls Received</span>
          <div class="stat-ico" style="background:#f0fdf4">
            <svg fill="none" viewBox="0 0 24 24" stroke="#16a34a" stroke-width="2"><path d="M22 16.92v3a2 2 0 01-2.18 2 19.79 19.79 0 01-8.63-3.07A19.5 19.5 0 013.07 9.81 19.79 19.79 0 012 1.18 2 2 0 014 0h3a2 2 0 012 1.72 12.84 12.84 0 00.7 2.81 2 2 0 01-.45 2.11L8.09 7.91a16 16 0 006 6l1.27-1.27a2 2 0 012.11-.45 12.84 12.84 0 002.81.7A2 2 0 0122 14.92z" transform="translate(1,1)"/></svg>
          </div>
        </div>
        <div class="stat-val" id="stat-calls">—</div>
        <div class="stat-sub" id="stat-calls-sub">Loading…</div>
      </div>
      <div class="stat-card">
        <div class="stat-top">
          <span class="stat-lbl">Pending Quotes</span>
          <div class="stat-ico" style="background:#fffbeb">
            <svg fill="none" viewBox="0 0 24 24" stroke="#d97706" stroke-width="2"><path d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"/></svg>
          </div>
        </div>
        <div class="stat-val" id="stat-quotes">—</div>
        <div class="stat-sub" id="stat-quotes-sub">Loading…</div>
      </div>
      <div class="stat-card">
        <div class="stat-top">
          <span class="stat-lbl">Scheduled Jobs</span>
          <div class="stat-ico" style="background:#f0fdfa">
            <svg fill="none" viewBox="0 0 24 24" stroke="#0d9488" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2"/><path d="M16 2v4M8 2v4M3 10h18"/></svg>
          </div>
        </div>
        <div class="stat-val" id="stat-scheduled">—</div>
        <div class="stat-sub" id="stat-scheduled-sub">Loading…</div>
      </div>
      <div class="stat-card">
        <div class="stat-top">
          <span class="stat-lbl">Total Revenue</span>
          <div class="stat-ico" style="background:#f0fdf4">
            <svg fill="none" viewBox="0 0 24 24" stroke="#16a34a" stroke-width="2"><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 000 7h5a3.5 3.5 0 010 7H6"/></svg>
          </div>
        </div>
        <div class="stat-val" id="stat-revenue">—</div>
        <div class="stat-sub" id="stat-revenue-sub">Loading…</div>
      </div>
    </div>

    <!-- Kanban header -->
    <div class="board-hdr">
      <span class="board-title">Lead Pipeline (Kanban Board)</span>
      <div class="board-ctrls">
        <button class="ctrl-btn">
          <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path d="M3 6h18M6 12h12M9 18h6"/></svg>
          Filter
        </button>
        <button class="ctrl-btn">
          <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path d="M12 4v16m8-8H4"/></svg>
          Add Column
        </button>
      </div>
    </div>

    <!-- Kanban Board -->
    <div class="board" id="board"></div>

  </div><!-- /page-leads -->

  <!-- ── OVERVIEW PAGE ── -->
  <div class="page" id="page-overview" style="display:none">
    <div style="margin-bottom:4px">
      <div style="font-size:17px;font-weight:700;color:var(--gray-900)">Overview</div>
      <div style="font-size:13px;color:var(--gray-500);margin-top:2px">Summary of your Pearl View lead activity</div>
    </div>
    <div class="stats" id="overview-stats"></div>
    <div style="background:#fff;border-radius:12px;border:1px solid var(--gray-200);padding:20px">
      <div style="font-size:14px;font-weight:700;color:var(--gray-900);margin-bottom:14px">Lead Sources</div>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px">
        <div style="background:var(--blue-50);border:1.5px solid var(--blue-200);border-radius:10px;padding:14px">
          <div style="font-size:11px;font-weight:700;text-transform:uppercase;letter-spacing:.05em;color:var(--primary);margin-bottom:6px">LP Site 1 · CrystalPro</div>
          <a href="https://crystalpro.com.au/" target="_blank" style="font-size:12.5px;color:var(--primary);text-decoration:none;display:flex;align-items:center;gap:5px">
            <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" style="width:13px;height:13px"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6M15 3h6v6M10 14L21 3"/></svg>
            crystalpro.com.au
          </a>
          <div style="margin-top:8px;font-size:12px;color:var(--gray-600)">Form leads + Call leads via this LP</div>
          <div id="ov-lp1-count" style="font-size:22px;font-weight:700;color:var(--gray-900);margin-top:6px">—</div>
        </div>
        <div style="background:#f5f3ff;border:1.5px solid #ddd6fe;border-radius:10px;padding:14px">
          <div style="font-size:11px;font-weight:700;text-transform:uppercase;letter-spacing:.05em;color:var(--purple);margin-bottom:6px">LP Site 2 · Pearl View</div>
          <a href="https://pearlview.com.au/" target="_blank" style="font-size:12.5px;color:var(--purple);text-decoration:none;display:flex;align-items:center;gap:5px">
            <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" style="width:13px;height:13px"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6M15 3h6v6M10 14L21 3"/></svg>
            pearlview.com.au
          </a>
          <div style="margin-top:8px;font-size:12px;color:var(--gray-600)">Form leads + Call leads via this LP</div>
          <div id="ov-lp2-count" style="font-size:22px;font-weight:700;color:var(--gray-900);margin-top:6px">—</div>
        </div>
      </div>
    </div>
    <div style="background:#fff;border-radius:12px;border:1px solid var(--gray-200);padding:20px">
      <div style="font-size:14px;font-weight:700;color:var(--gray-900);margin-bottom:14px">Recent Leads (Last 10)</div>
      <div id="overview-recent"></div>
    </div>
  </div>

  <!-- ── CLIENTS PAGE ── -->
  <div class="page" id="page-clients" style="display:none">
    <div style="font-size:17px;font-weight:700;color:var(--gray-900);margin-bottom:4px">Clients</div>
    <div style="font-size:13px;color:var(--gray-500);margin-bottom:16px">All unique clients from form submissions</div>
    <div id="clients-list"></div>
  </div>

  <!-- ── STUB PAGES ── -->
  <div class="page" id="page-calendar" style="display:none">
    <div style="font-size:17px;font-weight:700;color:var(--gray-900);margin-bottom:4px">Calendar</div>
    <div style="font-size:13px;color:var(--gray-500);margin-bottom:20px">Scheduled jobs and follow-up dates</div>
    <div id="calendar-list"></div>
  </div>
  <div class="page" id="page-reports" style="display:none">
    <div style="font-size:17px;font-weight:700;color:var(--gray-900);margin-bottom:4px">Reports</div>
    <div style="font-size:13px;color:var(--gray-500);margin-bottom:20px">Analytics coming in Phase 4</div>
    <div style="background:#fff;border-radius:12px;border:1px solid var(--gray-200);padding:32px;text-align:center">
      <svg fill="none" viewBox="0 0 24 24" stroke="var(--gray-300)" stroke-width="1.5" style="width:48px;height:48px;margin:0 auto 12px"><path d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/></svg>
      <div style="font-size:14px;font-weight:600;color:var(--gray-500)">Reports — Coming in Phase 4</div>
      <div style="font-size:12.5px;color:var(--gray-400);margin-top:6px">Conversion rates, lead volume, revenue tracking</div>
    </div>
  </div>
  <div class="page" id="page-crew" style="display:none">
    <div style="font-size:17px;font-weight:700;color:var(--gray-900);margin-bottom:4px">Crew & Jobs</div>
    <div style="font-size:13px;color:var(--gray-500);margin-bottom:20px">Crew assignment coming in Phase 3</div>
    <div style="background:#fff;border-radius:12px;border:1px solid var(--gray-200);padding:32px;text-align:center">
      <svg fill="none" viewBox="0 0 24 24" stroke="var(--gray-300)" stroke-width="1.5" style="width:48px;height:48px;margin:0 auto 12px"><path d="M17 20h5v-2a4 4 0 00-4-4H6a4 4 0 00-4 4v2h5"/><circle cx="12" cy="7" r="4"/></svg>
      <div style="font-size:14px;font-weight:600;color:var(--gray-500)">Crew & Jobs — Coming in Phase 3</div>
      <div style="font-size:12.5px;color:var(--gray-400);margin-top:6px">Assign crews, track job status, schedule appointments</div>
    </div>
  </div>
  <div class="page" id="page-settings" style="display:none">
    <div style="font-size:17px;font-weight:700;color:var(--gray-900);margin-bottom:4px">Settings</div>
    <div style="font-size:13px;color:var(--gray-500);margin-bottom:16px">Dashboard configuration</div>
    <div style="background:#fff;border-radius:12px;border:1px solid var(--gray-200);padding:20px;display:flex;flex-direction:column;gap:14px">
      <div style="font-size:13px;font-weight:600;color:var(--gray-700)">Airtable Connection</div>
      <div style="font-size:12.5px;color:var(--gray-500)">Base: <code style="background:var(--gray-100);padding:2px 6px;border-radius:4px">appNc7dQkFIq0dFFM</code></div>
      <div style="font-size:12.5px;color:var(--gray-500)">Table: <code style="background:var(--gray-100);padding:2px 6px;border-radius:4px">Leads (tblS1keAU26CH08KJ)</code></div>
      <div style="font-size:12.5px;color:var(--gray-500)">LP1: <a href="https://crystalpro.com.au/" target="_blank" style="color:var(--primary)">crystalpro.com.au</a></div>
      <div style="font-size:12.5px;color:var(--gray-500)">LP2: <a href="https://pearlview.com.au/" target="_blank" style="color:var(--primary)">pearlview.com.au</a></div>
      <button class="action-btn btn-blue" style="width:auto;align-self:flex-start;padding:8px 18px" onclick="fetchAllFromAirtable();showPage('leads',document.querySelector('[data-page=leads]'))">
        Refresh Data from Airtable
      </button>
    </div>
  </div>

</main>

<!-- ══════════════ DETAIL PANEL ══════════════ -->
<aside class="panel" id="panel">
  <div class="panel-hdr">
    <div class="panel-title">
      <h2 id="p-name">—</h2>
      <div class="panel-meta" id="p-meta">—</div>
    </div>
    <button class="close-btn" onclick="closePanel()">✕</button>
  </div>
  <div class="panel-body" id="panel-body"></div>
</aside>

<!-- ══════════════ LOADING OVERLAY ══════════════ -->
<div id="loading-overlay" style="
  display:flex; position:fixed; inset:0; background:rgba(255,255,255,.9);
  z-index:300; align-items:center; justify-content:center; flex-direction:column; gap:14px;">
  <div style="width:36px;height:36px;border:3px solid var(--blue-100);border-top-color:var(--primary);
    border-radius:50%;animation:spin .7s linear infinite;"></div>
  <span style="font-size:13.5px;font-weight:500;color:var(--gray-500)">Loading leads from Airtable…</span>
</div>
<style>@keyframes spin{to{transform:rotate(360deg)}}</style>

<!-- ══════════════ NEW LEAD MODAL ══════════════ -->
<div class="overlay" id="modal-overlay" onclick="overlayClick(event)">
  <div class="modal">
    <div class="modal-title">+ Add New Lead</div>
    <div class="fgroup">
      <label class="flabel">Source</label>
      <select class="fselect" id="m-source">
        <option value="form1">Form — LP Site 1</option>
        <option value="form2">Form — LP Site 2</option>
        <option value="call">Direct Call</option>
      </select>
    </div>
    <div class="fgroup">
      <label class="flabel">Full Name</label>
      <input class="finput" id="m-name" placeholder="e.g. John Smith" />
    </div>
    <div class="fgroup">
      <label class="flabel">Phone</label>
      <input class="finput" id="m-phone" placeholder="(555) 000-0000" />
    </div>
    <div class="fgroup">
      <label class="flabel">Email</label>
      <input class="finput" id="m-email" placeholder="email@example.com" />
    </div>
    <div class="fgroup">
      <label class="flabel">Subject / Reason</label>
      <textarea class="ftextarea" id="m-subject" placeholder="e.g. Quotation for 3-story commercial building, 20 windows…"></textarea>
    </div>
    <div class="fgroup">
      <label class="flabel">Estimated Value ($)</label>
      <input class="finput" id="m-value" type="number" placeholder="0" />
    </div>
    <div class="modal-footer">
      <button class="btn-cancel" onclick="closeModal()">Cancel</button>
      <button class="btn-save-modal" onclick="saveLead()">Save Lead</button>
    </div>
  </div>
</div>

<script src="config.js"></script>

</body>
</html>
<script src="script.js"></script>